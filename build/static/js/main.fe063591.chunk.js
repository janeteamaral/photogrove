(this.webpackJsonpphotogrove=this.webpackJsonpphotogrove||[]).push([[0],{105:function(e,t,a){e.exports=a(128)},110:function(e,t,a){},128:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(35),c=a.n(o),l=(a(110),a(72)),i=a(36),u=a.n(i),s=a(47),d=a(15),m=(a(42),a(28)),g=a(104),f=a(94),b=function(){return window.history.replaceState({},document.title,window.location.pathname)},p=r.a.createContext(),v=function(){return Object(n.useContext)(p)},h=function(e){var t=e.children,a=e.onRedirectCallback,o=void 0===a?b:a,c=Object(g.a)(e,["children","onRedirectCallback"]),l=Object(n.useState)(),i=Object(d.a)(l,2),m=i[0],v=i[1],h=Object(n.useState)(),E=Object(d.a)(h,2),j=E[0],O=E[1],w=Object(n.useState)(),I=Object(d.a)(w,2),k=I[0],y=I[1],_=Object(n.useState)(!0),N=Object(d.a)(_,2),S=N[0],$=N[1],P=Object(n.useState)(!1),x=Object(d.a)(P,2),q=x[0],F=x[1];Object(n.useEffect)((function(){(function(){var e=Object(s.a)(u.a.mark((function e(){var t,a,n,r,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(f.a)(c);case 2:if(t=e.sent,y(t),!window.location.search.includes("code=")){e.next=10;break}return e.next=7,t.handleRedirectCallback();case 7:a=e.sent,n=a.appState,o(n);case 10:return e.next=12,t.isAuthenticated();case 12:if(r=e.sent,v(r),!r){e.next=19;break}return e.next=17,t.getUser();case 17:l=e.sent,O(l);case 19:$(!1);case 20:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]);var C=function(){var e=Object(s.a)(u.a.mark((function e(){var t,a,n=arguments;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},F(!0),e.prev=2,e.next=5,k.loginWithPopup(t);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.error(e.t0);case 10:return e.prev=10,F(!1),e.finish(10);case 13:return e.next=15,k.getUser();case 15:a=e.sent,O(a),v(!0);case 18:case"end":return e.stop()}}),e,null,[[2,7,10,13]])})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=Object(s.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $(!0),e.next=3,k.handleRedirectCallback();case 3:return e.next=5,k.getUser();case 5:t=e.sent,$(!1),v(!0),O(t);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(p.Provider,{value:{isAuthenticated:m,user:j,loading:S,popupOpen:q,loginWithPopup:C,handleRedirectCallback:U,getIdTokenClaims:function(){return k.getIdTokenClaims.apply(k,arguments)},loginWithRedirect:function(){return k.loginWithRedirect.apply(k,arguments)},getTokenSilently:function(){return k.getTokenSilently.apply(k,arguments)},getTokenWithPopup:function(){return k.getTokenWithPopup.apply(k,arguments)},logout:function(){return k.logout.apply(k,arguments)}}},t)};var E=function(){var e=v(),t=e.isAuthenticated,a=e.loginWithRedirect,n=(e.logout,e.user);return r.a.createElement("nav",{className:"Nav"},r.a.createElement("div",{className:"Nav-menus"},r.a.createElement("div",{className:"Nav-brand"},r.a.createElement(m.b,{className:"Nav-brand-logo",to:"/"},"PhotoGrove - Janete Amaral")),r.a.createElement("div",{className:"Nav-search"}," "),r.a.createElement("div",{className:"Nav-brand-direita"}," "),!t&&r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"Nav-user-button button-no-style",onClick:function(){return a({})}})),t&&r.a.createElement(r.a.Fragment,null,r.a.createElement(m.b,{className:"Nav-user-button",to:"/user/"+n.sub}))))},j=a(19),O=a(18),w=a(17);function I(){var e=Object(j.a)(["\n  mutation($postId: Int!, $userId: String!) {\n    delete_Like(\n      where: { user_id: { _eq: $userId }, post_id: { _eq: $postId } }\n    ) {\n      affected_rows\n    }\n  }\n"]);return I=function(){return e},e}function k(){var e=Object(j.a)(["\n  mutation($postId: Int!, $userId: String!) {\n    insert_Like(objects: [{ post_id: $postId, user_id: $userId }]) {\n      affected_rows\n    }\n  }\n"]);return k=function(){return e},e}function y(){var e=Object(j.a)(["\n  query($id: Int!, $userId: String!) {\n    Post(where: { id: { _eq: $id } }) {\n      Likes_aggregate {\n        aggregate {\n          count\n        }\n      }\n      Likes(where: { user_id: { _eq: $userId } }) {\n        id\n      }\n    }\n  }\n"]);return y=function(){return e},e}var _=Object(O.a)(y()),N=Object(O.a)(k()),S=Object(O.a)(I());var $=function(e){var t=v(),a=t.isAuthenticated,o=t.user,c=Object(n.useState)(!1),l=Object(d.a)(c,2),i=l[0],u=l[1],s=Object(n.useState)(-1),m=Object(d.a)(s,2),g=m[0],f=m[1],b=Object(n.useRef)(null);b.current=a?o.sub:"none";var p=Object(w.useMutation)(N,{variables:{postId:e.postId,userId:b.current},refetchQueries:[{query:_,variables:{id:e.postId,userId:b.current}}]}),h=Object(d.a)(p,1)[0],E=Object(w.useMutation)(S,{variables:{postId:e.postId,userId:b.current},refetchQueries:[{query:_,variables:{id:e.postId,userId:b.current}}]}),j=Object(d.a)(E,1)[0],O=Object(w.useQuery)(_,{variables:{id:e.postId,userId:b.current}}),I=O.loading,k=O.error,y=O.data;return I?"Loading...":k?"Error! ".concat(k.message):(-1===g&&(y.Post[0].Likes.length>0&&u(!0),f(y.Post[0].Likes_aggregate.aggregate.count)),r.a.createElement("div",{className:"post-like-container"},a&&r.a.createElement(r.a.Fragment,null,!i&&r.a.createElement("button",{className:"post-like-button-white button-nodec",onClick:function(){h(),u(!0),f(g+1)}}),i&&r.a.createElement("button",{className:"post-like-button-black button-nodec",onClick:function(){j(),u(!1),f(g-1)}})),g?r.a.createElement("span",{className:"Post-likes"},r.a.createElement("strong",null,g," likes")):null))};function P(e){return function(e,t){var a=e-t;return a<2e4?"just now":a<6e4?"less than 1 min ago":a<36e5?Math.round(a/6e4)+" min ago":a<864e5?Math.round(a/36e5)+" h ago":a<2592e6?Math.round(a/864e5)+" days ago":a<31536e6?Math.round(a/2592e6)+" mo ago":Math.round(a/31536e6)+" years ago"}((new Date).getTime(),new Date(e).getTime())}var x=a(132);function q(){var e=Object(j.a)(["\n  query($id: Int!) {\n    Post(where: { id: { _eq: $id } }) {\n      id\n      caption\n      created_at\n      url\n      User {\n        avatar\n        id\n        name\n      }\n    }\n  }\n"]);return q=function(){return e},e}var F=Object(O.a)(q());var C=function(e){var t=e.id?e.id:e.match.params.id,a=Object(w.useQuery)(F,{variables:{id:t}}),n=a.loading,o=a.error,c=a.data;return n?"Loading Post.js..":o?"Error! ".concat(o.message):r.a.createElement(r.a.Fragment,null,r.a.createElement(x.a,null,c.Post.map((function(e,a){return r.a.createElement("article",{className:"Post",key:a},r.a.createElement("header",null,r.a.createElement("div",{className:"Post-user"},r.a.createElement("div",{className:"Post-user-avatar"},r.a.createElement(m.b,{to:"/user/"+e.User.id},r.a.createElement("img",{src:e.User.avatar,alt:e.User.name}))),r.a.createElement("div",{className:"Post-user-nickname"},r.a.createElement(m.b,{className:"anchor-nodec",to:"/user/"+e.User.id},r.a.createElement("span",null,e.User.name))))),r.a.createElement("div",{className:"Post-image"},r.a.createElement("div",{className:"Post-image-bg"},r.a.createElement("img",{alt:e.caption,src:e.url}))),r.a.createElement($,{postId:t}),r.a.createElement("div",{className:"Post-caption"},r.a.createElement(m.b,{className:"anchor-nodec",to:"/user/"+e.User.id},r.a.createElement("strong",null,e.User.name)),"\xa0",e.caption),r.a.createElement("div",{className:"Post-time"},P(e.created_at)))}))))},U=a(14),L=a(133),R=a(134),Q=a(136);function A(){var e=Object(j.a)(["\n  mutation($followingId: String!, $userId: String!) {\n    delete_Follow(\n      where: {\n        follower_id: { _eq: $userId }\n        following_id: { _eq: $followingId }\n      }\n    ) {\n      affected_rows\n    }\n  }\n"]);return A=function(){return e},e}function M(){var e=Object(j.a)(["\n  mutation($followingId: String!, $userId: String!) {\n    insert_Follow(\n      objects: [{ follower_id: $userId, following_id: $followingId }]\n    ) {\n      affected_rows\n    }\n  }\n"]);return M=function(){return e},e}function T(){var e=Object(j.a)(["\n  query($followingId: String!, $userId: String!) {\n    Follow(\n      where: {\n        follower_id: { _eq: $userId }\n        following_id: { _eq: $followingId }\n      }\n    ) {\n      id\n    }\n  }\n"]);return T=function(){return e},e}var W=Object(O.a)(T()),B=Object(O.a)(M()),J=Object(O.a)(A());var D=function(e){var t=v(),a=t.isAuthenticated,o=t.user,c=Object(n.useState)(!1),l=Object(d.a)(c,2),i=l[0],u=l[1],s=Object(n.useRef)(!0),m=Object(n.useRef)(null);m.current=a?o.sub:"none";var g=Object(w.useMutation)(B,{variables:{followingId:e.id,userId:m.current},refetchQueries:[{query:W,variables:{followingId:e.id,userId:m.current}},{query:X,variables:{id:e.id}},{query:V,variables:{id:m.current}}]}),f=Object(d.a)(g,1)[0],b=Object(w.useMutation)(J,{variables:{followingId:e.id,userId:m.current},refetchQueries:[{query:W,variables:{followingId:e.id,userId:m.current}},{query:X,variables:{id:e.id}},{query:V,variables:{id:m.current}}]}),p=Object(d.a)(b,1)[0],h=Object(w.useQuery)(W,{variables:{followingId:e.id,userId:m.current}}),E=h.loading,j=h.error,O=h.data;return E?"Loading Follow.js...":j?"Error! ".concat(j.message):(s.current&&(O.Follow.length>0&&u(!0),s.current=!1),r.a.createElement("div",{className:"post-like-container"},!i&&r.a.createElement(Q.a,{variant:"outline-secondary",className:"profile-logout",onClick:function(){f(),u(!0)}},"Follow"),i&&r.a.createElement(Q.a,{variant:"outline-success",className:"profile-logout",onClick:function(){p(),u(!1)}},"Following")))};function z(){var e=Object(j.a)(["\n  query($id: String!) {\n    Follow_aggregate(where: { following_id: { _eq: $id } }) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]);return z=function(){return e},e}function H(){var e=Object(j.a)(["\n  query($id: String!) {\n    Follow_aggregate(where: { follower_id: { _eq: $id } }) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]);return H=function(){return e},e}function G(){var e=Object(j.a)(["\n  query($id: String!) {\n    User(where: { id: { _eq: $id } }) {\n      email\n      avatar\n      last_seen\n      name\n      Posts_aggregate {\n        aggregate {\n          count\n        }\n      }\n    }\n    Post(where: { user_id: { _eq: $id } }) {\n      url\n      caption\n      id\n    }\n  }\n"]);return G=function(){return e},e}var K=Object(O.a)(G()),V=Object(O.a)(H()),X=Object(O.a)(z());var Y=Object(U.f)((function(e){var t=v(),a=t.isAuthenticated,n=t.logout,o=t.user,c=function(){return o.sub===e.match.params.id},l=Object(w.useQuery)(K,{variables:{id:e.match.params.id}}),i=l.loading,u=l.error,s=l.data,d=Object(w.useQuery)(X,{variables:{id:e.match.params.id}}),g=Object(w.useQuery)(V,{variables:{id:e.match.params.id}});return i?"Loading...":u?"Error! ".concat(u.message):g.loading?"Loading Profile.js - Following...":d.loading?"Loading Profile.js - Followers...":g.error||d.error?"Error! ".concat(u.message):r.a.createElement(r.a.Fragment,null,r.a.createElement(x.a,{className:"container"},r.a.createElement(x.a,{className:"profile-details"},s.User.map((function(t,o){return r.a.createElement(L.a,{key:o},r.a.createElement(R.a,{xs:4},r.a.createElement("img",{className:"profile-avatar",alt:t.name,src:t.avatar})),r.a.createElement(R.a,null,r.a.createElement(L.a,null,r.a.createElement(R.a,{className:"profile-username",xs:"auto"},t.name," "," "),r.a.createElement(R.a,{className:"profile-logout",xs:4},a&&r.a.createElement(r.a.Fragment,null,c()&&r.a.createElement(r.a.Fragment,null,r.a.createElement(Q.a,{variant:"outline-secondary",className:"profile-logout",onClick:function(){return n()}},"Sair")),!c()&&r.a.createElement(D,{id:e.match.params.id})))),r.a.createElement(L.a,null,r.a.createElement(R.a,{className:"profile-stats",xs:"auto"},r.a.createElement("strong",null,"   "," Postagens - ","   ",t.Posts_aggregate.aggregate.count," *  ")),r.a.createElement(R.a,{className:"profile-stats",xs:"auto"},r.a.createElement("strong",null,"    ","   Seguidores - ","   ",d.data.Follow_aggregate.aggregate.count," *  ")),r.a.createElement(R.a,{className:"profile-stats",xs:"auto"},r.a.createElement("strong",null,"   ","     Seguindo - ","  ",g.data.Follow_aggregate.aggregate.count)))))}))),r.a.createElement("hr",null),r.a.createElement(L.a,null,s.Post.map((function(e,t){return r.a.createElement(m.b,{to:"/post/"+e.id,key:t},r.a.createElement(R.a,{xs:4,className:"profile-grid"},r.a.createElement("div",{class:"profile-post-image"},r.a.createElement("img",{className:"profile-post-image",alt:e.caption,src:e.url}))))})))))}));function Z(){var e=Object(j.a)(["\n  {\n    Post(order_by: { created_at: desc }) {\n      id\n    }\n  }\n"]);return Z=function(){return e},e}var ee=Object(O.a)(Z());var te=function(e){var t=Object(w.useQuery)(ee),a=t.loading,n=t.error,o=t.data;return a?"Loading .............Feed.js...":n?"Error! ".concat(n.message):r.a.createElement(r.a.Fragment,null,o.Post.map((function(e,t){return r.a.createElement(C,{id:e.id,key:t})})))},ae=a(135),ne=a(69);function re(){var e=Object(j.a)(["\n  mutation($url: String!, $userId: String!, $caption: String!) {\n    insert_Post(objects: { url: $url, caption: $caption, user_id: $userId }) {\n      affected_rows\n    }\n  }\n"]);return re=function(){return e},e}var oe=Object(O.a)(re());var ce=function(){var e=r.a.useState(!1),t=Object(d.a)(e,2),a=t[0],o=t[1],c=v().user,l=Object(n.useState)(""),i=Object(d.a)(l,2),u=i[0],s=i[1],m=Object(n.useState)(""),g=Object(d.a)(m,2),f=g[0],b=g[1],p=Object(n.useState)(""),h=Object(d.a)(p,2),E=h[0],j=h[1],O=Object(w.useMutation)(oe),I=Object(d.a)(O,1)[0];return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{className:"button-nodec post-upload-button",onClick:function(){return o(!0)}}),r.a.createElement(ae.a,{show:a,onHide:function(){return o(!1)},size:"lg","aria-labelledby":"contained-modal-title-vcenter",centered:!0},r.a.createElement(ae.a.Header,{closeButton:!0},r.a.createElement(ae.a.Title,{id:"contained-modal-title-vcenter"},"Inserir Posts")),r.a.createElement(ae.a.Body,null,r.a.createElement(x.a,null,r.a.createElement("form",{onSubmit:function(e){e.preventDefault();var t=new Image;t.onload=function(){I({variables:{caption:u,userId:c.sub,url:f},refetchQueries:[{query:ee},{query:K,variables:{id:c.sub}}]}).catch((function(e){console.log(e),j(e.toString())}))},t.onerror=function(){Object(ne.a)("N\xe3o foi encontrada imagem na URL informada")},t.src=f,s(""),b("")}},r.a.createElement(L.a,null,r.a.createElement("span",null,"Entrar uma URL v\xe1lida de uma imagem")),r.a.createElement(L.a,null,r.a.createElement("input",{value:f,onChange:function(e){return b(e.target.value)},type:"text"})),r.a.createElement(L.a,null,r.a.createElement("span",null,"Legenda:")),r.a.createElement(L.a,null,r.a.createElement("input",{value:u,onChange:function(e){return s(e.target.value)},type:"text"})),r.a.createElement(L.a,null,r.a.createElement(Q.a,{variant:"outline-dark",className:"profile-logout top-padding",type:"submit",value:"Submit",onClick:function(){return o(!1)}},"Submit")),E)))))};var le=function(e){var t=e.component,a=e.path,n=v(),o=n.isAuthenticated,c=n.loginWithRedirect;return r.a.createElement(U.a,{path:a,render:function(){return o?r.a.createElement(t,null):(c({}),r.a.createElement("div",null))}})},ie=a(62),ue=a(58),se=a(51),de=a(103);a(127);var me=function(){var e=v(),t=e.isAuthenticated,a=(e.user,Object(n.useState)("")),o=Object(d.a)(a,2),c=o[0],i=o[1],m=v(),g=m.getTokenSilently;if(m.loading)return"Loading...App.js";(function(){var e=Object(s.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g();case 3:t=e.sent,i(t),console.log(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}})()();var f=new ie.a({uri:"https://photogrove.herokuapp.com/v1/graphql"}),b=Object(de.a)((function(e,t){var a=t.headers,n=c;return n?{headers:Object(l.a)(Object(l.a)({},a),{},{authorization:"Bearer ".concat(n)})}:{headers:Object(l.a)({},a)}})),p=new ue.a({link:b.concat(f),cache:new se.a});return ne.a.configure(),r.a.createElement(w.ApolloProvider,{client:p},r.a.createElement(E,null),t&&r.a.createElement(ce,null),r.a.createElement(U.c,null,r.a.createElement(U.a,{exact:!0,path:"/",component:te}),r.a.createElement(U.a,{path:"/post/:id",component:C}),r.a.createElement(le,{path:"/user/:id",component:Y})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ge=a(71);c.a.render(r.a.createElement(m.a,null,r.a.createElement(h,{domain:ge.domain,client_id:ge.clientId,audience:ge.audience,redirect_uri:"http://localhost:3000/",onRedirectCallback:function(e){window.history.replaceState({},document.title,e&&e.targetUrl?e.targetUrl:window.location.pathname)}},r.a.createElement(me,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},42:function(e,t,a){},71:function(e){e.exports=JSON.parse('{"domain":"dev-xm82t8w6.us.auth0.com","clientId":"j1Uf5iOQSatbsNaeiydC3b3wUv5UbFBh","redirectUri":"http://localhost:3000","audience":"https://photogrove.herokuapp.com/v1/graphql"}')}},[[105,1,2]]]);
//# sourceMappingURL=main.fe063591.chunk.js.map